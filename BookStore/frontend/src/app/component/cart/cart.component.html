<div class="cart-container">
  <h2>GIỎ HÀNG</h2>

  <div class="delete-all-container" *ngIf="selectedBooks.length > 0">
    <button class="delete-all-btn" (click)="removeAllSelected()" mat-button>
      XÓA TẤT CẢ
    </button>
    <button class="deselect-all-btn" (click)="deselectAll()" mat-button>
      BỎ CHỌN TẤT CẢ
    </button>
  </div>
  <p-table #dt [value]="(cart$ | async) || []" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5, 10, 20]">
    <ng-template pTemplate="header">
      <tr>
        <th>
          <p-checkbox 
            (change)="deselectAll()" 
            [binary]="true" 
            [ngModel]="selectedBooks.length === (cart$ | async)?.length">
          </p-checkbox>
        </th>
        <th>Sản phẩm</th>
        <th>Giá</th>
        <th>Số lượng</th>
        <th>Thành tiền</th>
        <th>Xóa</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-book>
      <tr>
        <td>
          <p-checkbox 
            (change)="onCheckboxChange(book, $event)" 
            [binary]="true">
          </p-checkbox>
        </td>
        <td>
          <img [src]="book.coverImage" alt="product" class="product-img" />
          {{ book.title }}
        </td>
        <td>
          <span class="discount-price">
            {{ book.flashsale_price || book.price | number:'1.3-3' }} đ
          </span>
        </td>
        <td>
          <button mat-button (click)="decreaseQuantity(book)" style="color: #fff; font-size: 16px;">-</button>
          <span>{{ book.quantity || 1 }}</span>
          <button mat-button (click)="increaseQuantity(book)" style="color: #fff;font-size: 16px">+</button>
        </td>
        <td class="total-price">
          {{ (book.flashsale_price || book.price) * (book.quantity || 1) | number:'1.3-3' }} đ
        </td>
        <td>
          <button class="delete-btn" (click)="removeItem(book._id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>
 

  <div class="cart-summary">
    <h3>Thành tiền: {{ totalPrice | number:'1.3-3' }} đ</h3>
    <p-button [rounded]="true" variant="outlined" severity="success" label="Thanh toán" size="large"></p-button>
  </div>
</div>
