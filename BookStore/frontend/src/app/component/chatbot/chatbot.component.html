<!-- Floating Button -->
<button class="chatbot-button" (click)="toggle()">
  üí¨
</button>

<!-- Chat Window -->
<div
  class="chatbot-window"
  *ngIf="open"
  @slideFade>

  <!-- Header -->
  <div class="chat-header">
    <span>üí¨ Tr·ª£ L√Ω AI</span>
    <button class="close-btn" (click)="toggle()">‚úñ</button>
  </div>

  <!-- Chat Body -->
  <div class="chat-body">
    <div *ngFor="let msg of messages" class="chat-message-wrapper" [ngClass]="msg.role">

      <!-- BOT MESSAGE -->
      <ng-container *ngIf="msg.role === 'bot'">
        <div class="avatar">
          <img src="assets/images/chatbot-drupal.webp" alt="Tr·ª£ l√Ω AI" />
        </div>

        <!-- ‚úÖ ƒê·∫∑t bubble chung flex v·ªõi avatar -->
        <div class="bubble">
          <div class="bot-header">Tr·ª£ l√Ω AI</div>
          <div class="content" [innerHTML]="formatMessage(msg.content)"></div>
          <!-- N·∫øu l√† suggestion, hi·ªán n√∫t b·∫Øt ƒë·∫ßu -->
          <div *ngIf="msg.type === 'suggestion'" class="suggestion-box">
            <button class="start-btn" (click)="startChat()">B·∫Øt ƒë·∫ßu</button>
          </div>

          <div *ngIf="msg.quotes?.length" class="quotes">
            <div *ngFor="let q of msg.quotes" class="quote-item">
              <img *ngIf="q.coverImage" [src]="q.coverImage" alt="{{ q.title }}" class="quote-img" />
              <div class="quote-info">
                <a [routerLink]="q.link" class="title">{{ q.title }}</a>
                <span class="price">{{ q.price | currency:'VND':'symbol':'1.0-0' }}</span>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

          <!-- USER MESSAGE -->
      <ng-container *ngIf="msg.role === 'user'">
        <div class="bubble">
          <div class="content" [innerHTML]="formatMessage(msg.content)"></div>
        </div>
      </ng-container>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="loading" class="chat-message bot">
      <div class="avatar">
        <img src="assets/images/chatbot-avatar.png" alt="Tr·ª£ l√Ω AI" />
      </div>
      <div class="bubble typing">ƒêang suy nghƒ©...</div>
    </div>
  </div>

  <!-- Footer -->
  <div class="chat-footer">
    <input [(ngModel)]="input" (keyup.enter)="send()" placeholder="Nh·∫≠p tin nh·∫Øn..." />
    <button class="send-btn" (click)="send()">‚û§</button>
  </div>
</div>
