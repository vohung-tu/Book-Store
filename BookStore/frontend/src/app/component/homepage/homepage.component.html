<canvas id="snow-canvas"></canvas>
<ng-container class="container-ads">
  <p-toast position="top-right" key="tr"></p-toast>

  <div class="content-ads-1">
    <img class="img-ads" src="assets/images/banner_noel.png" alt="" width="840px" height="340px" loading="lazy">
    <div class="content-ads-2">
      <a routerLink="/">
        <img src="assets/images/ads_2.webp" alt="" loading="lazy">
      </a>
      <a href="">
        <img class="img-ads" src="assets/images/coupon.webp" alt="" loading="lazy">
      </a>
    </div>
  </div>

  <div class="container-category">
    <div class="category">
      <div class="cate-child" *ngFor="let cat of categories; trackBy: trackById">
        <a (click)="navigateToCategory(cat.slug); $event.stopPropagation()">
          <img [src]="imageFor(cat.slug)" [alt]="cat.name" width="120" height="75" loading="lazy" />
          <span>{{ cat.name }}</span>
        </a>
      </div>

       <!-- Category hardcode cho Mã giảm giá -->
      <div class="cate-child special-coupon">
        <a routerLink="/coupons">
          <img src="assets/images/coupon-icon.png" alt="Mã giảm giá" width="120" height="75" />
          <span>Mã giảm giá</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Sản phẩm bạn quan tâm  -->

  <div class="als-suggestion-section" *ngIf="isLoadingAls || alsSuggestions?.length">

    <div class="als-title">
      <h1>
        <i class="pi pi-eye"></i> Sản phẩm bạn quan tâm
      </h1>
    </div>

    <div class="als-body">
      <!-- Skeleton loading -->
      <div *ngIf="isLoadingAls" class="skeleton-container">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]"></div>
      </div>

      <!-- Carousel ALS -->
      <p-carousel 
        *ngIf="!isLoadingAls && alsSuggestions.length > 0"
        [value]="alsSuggestions"
        [numVisible]="5"
        [numScroll]="5"
        [circular]="false"
        [responsiveOptions]="responsiveOptions">
        <ng-template let-book pTemplate="item">
          <app-product-item [book]="book" (showToast)="handleToast($event)"></app-product-item>
        </ng-template>
      </p-carousel>

      <!-- no items -->
      <p *ngIf="!isLoadingAls && alsSuggestions.length === 0">
        Chưa có dữ liệu đề xuất.
      </p>

    </div>
  </div>

  <!-- flashsale bán chạy -->

  <div class="container-flashsale">
    <div class="flash-sale-countdown">
      <h1>Sách bán chạy</h1>
    </div>    
      
    <div class="flashsale-col">
      <div class="flashsale-col-1">

        <!-- ✅ Skeleton hiển thị khi đang load -->
        <div *ngIf="isLoadingBestSeller" class="skeleton-container">
          <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]"></div>
        </div>

        <!-- ✅ Carousel khi có dữ liệu -->
        <p-carousel 
          *ngIf="!isLoadingBestSeller && bestSellerBooks.length > 0"
          [value]="bestSellerBooks"
          [numVisible]="5"
          [numScroll]="5"
          [circular]="false"
          [responsiveOptions]="responsiveOptions">
          <ng-template let-book pTemplate="item">
            <app-product-item [book]="book" (showToast)="handleToast($event)"></app-product-item>
          </ng-template>
        </p-carousel>

        <!-- ✅ Trường hợp không có sách -->
        <p *ngIf="!isLoadingBestSeller && bestSellerBooks.length === 0">
          Hiện chưa có sách bán chạy.
        </p>

      </div>
    </div>
  </div>

  <p-divider class="custom-divider"></p-divider>

  <div class="featured-books" #featuredTrigger>
    <div class="featured-title">
      <h1>Tủ sách nổi bật</h1>
    </div> 
    <div class="featured-body">

      <div *ngIf="isLoadingFeatured" class="skeleton-container">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]"></div>
      </div>

      <p-carousel *ngIf="!isLoadingFeatured && featuredBooks.length > 0"
                  [value]="featuredBooks" [numVisible]="5" [numScroll]="5"
                  [circular]="false" [responsiveOptions]="responsiveOptions">
        <ng-template let-book pTemplate="item">
          <app-product-item [book]="book" (showToast)="handleToast($event)"></app-product-item>
        </ng-template>
      </p-carousel>

    </div>
  </div>
  
  <p-divider class="custom-divider"></p-divider>
  
  <div class="new-release-books" #newReleaseTrigger>
    <div class="new-release-title">
      <h1>Sách mới ra</h1>
    </div> 
    <div class="new-release-body">

      <div *ngIf="isLoadingNewRelease" class="skeleton-container">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]"></div>
      </div>

      <p-carousel *ngIf="!isLoadingNewRelease && newReleaseBooks.length > 0"
                  [value]="newReleaseBooks" [numVisible]="5" [numScroll]="5"
                  [circular]="false" [responsiveOptions]="responsiveOptions">
        <ng-template let-book pTemplate="item">
          <app-product-item [book]="book" (showToast)="handleToast($event)"></app-product-item>
        </ng-template>
      </p-carousel>

    </div>
  </div>
  
  <!-- <p-divider class="custom-divider"></p-divider> -->

  <!-- Lễ hội ma quái -->
  <div class="holiday-halloween-section" *ngIf="halloweenBooks?.length">

    <div class="section-body">
      <p-carousel 
        [value]="halloweenBooks" 
        [numVisible]="5" 
        [numScroll]="5" 
        [circular]="false" 
        [responsiveOptions]="responsiveOptions"
        styleClass="halloween-carousel"
      >
        <ng-template let-book pTemplate="item">
          <app-product-item [book]="book" (showToast)="handleToast($event)"></app-product-item>
        </ng-template>
      </p-carousel>
    </div>
  </div>

  <p-divider class="custom-divider"></p-divider>

  <div class="incomming-release-books" #incomingTrigger>
    <div class="incomming-release-title">
      <h1>Sách sắp ra mắt</h1>
    </div> 
    <div class="incomming-release-body">

      <!-- ✅ Skeleton watermark khi đang load -->
      <div *ngIf="isLoadingIncoming" class="skeleton-container">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]"></div>
      </div>

      <!-- ✅ Carousel khi có data -->
      <p-carousel 
        *ngIf="!isLoadingIncoming && incommingReleaseBooks.length > 0"
        [value]="incommingReleaseBooks"
        [numVisible]="5"
        [numScroll]="5"
        [circular]="false"
        [responsiveOptions]="responsiveOptions">
        <ng-template let-book pTemplate="item">
          <app-product-item 
            [book]="book"
            [isUpcomingRelease]="true"
            (showToast)="handleToast($event)">
          </app-product-item>
        </ng-template>
      </p-carousel>

      <!-- Trường hợp không có sách -->
      <p *ngIf="!isLoadingIncoming && incommingReleaseBooks.length === 0">
        Hiện chưa có sách sắp phát hành.
      </p>
    </div>
  </div>
  
  <p-divider class="custom-divider"></p-divider>

    <!-- BẠN VỪA XEM  -->
  <div class="recent-view-section" *ngIf="isLoadingRecentViews || recentViewedBooks?.length">
    <div class="recent-title">
      <h1><i class="pi pi-history"></i> Sản phẩm bạn vừa xem </h1>
    </div>

    <div class="recent-body">
      <!-- Skeleton -->
      <div *ngIf="isLoadingRecentViews" class="skeleton-container">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]"></div>
      </div>

      <!-- Carousel -->
      <p-carousel 
        *ngIf="!isLoadingRecentViews && recentViewedBooks.length > 0"
        [value]="recentViewedBooks"
        [numVisible]="5"
        [numScroll]="5"
        [circular]="false"
        [responsiveOptions]="responsiveOptions">
        <ng-template let-book pTemplate="item">
          <app-product-item 
            [book]="book"
            (showToast)="handleToast($event)">
          </app-product-item>
        </ng-template>
      </p-carousel>
    </div>
  </div>

  <p-divider class="custom-divider"></p-divider>


  <!--  Có thể bạn sẽ thích -->
  <div class="ai-recommendation-books" #recommendTrigger>
    <div class="ai-recommendation-title">
      <h1><i class="pi pi-sparkles"></i> Có thể bạn sẽ thích</h1>
    </div>

    <div class="ai-recommendation-body">
      <div *ngIf="isLoadingRecommended" class="skeleton-container">
        <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]"></div>
      </div>

      <p-carousel 
        *ngIf="!isLoadingRecommended && recommendedBooks.length > 0"
        [value]="recommendedBooks"
        [numVisible]="5"
        [numScroll]="5"
        [circular]="false"
        [responsiveOptions]="responsiveOptions">
        <ng-template let-book pTemplate="item">
          <app-product-item 
            [book]="book"
            (showToast)="handleToast($event)">
          </app-product-item>
        </ng-template>
      </p-carousel>

      <p *ngIf="!isLoadingRecommended && recommendedBooks.length === 0">
        Hiện chưa có gợi ý nào cho bạn.
      </p>
    </div>
  </div>


  <p-divider class="custom-divider"></p-divider>
<!-- 
  <div class="newest-col">

    <p-tabs value="0">
      <p-tablist>
        <p-tab value="0">Sách Tham Khảo</p-tab>
        <p-tab value="1">Sách Trong Nước</p-tab>
      </p-tablist>
      <p-tabpanels>

        <div *ngIf="isLoadingReference" class="skeleton-container">
          <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5]"></div>
        </div>

        <p-tabpanel value="0">
          <ng-container *ngIf="!isLoadingReference && referenceCarouselKey">

            <p-carousel
              [value]="sachThamKhao"
              [numVisible]="5"
              [numScroll]="3"
              [circular]="false"
              [responsiveOptions]="responsiveOptions">

              <ng-template pTemplate="item" let-book>
                <app-product-item
                  [book]="book"
                  (showToast)="handleToast($event)">
                </app-product-item>
              </ng-template>

            </p-carousel>

          </ng-container>
        </p-tabpanel>

        <p-tabpanel value="1">
          <ng-container *ngIf="!isLoadingReference && referenceCarouselKey">

            <p-carousel
              [value]="sachTrongNuoc"
              [numVisible]="5"
              [numScroll]="3"
              [circular]="false"
              [responsiveOptions]="responsiveOptions">

              <ng-template pTemplate="item" let-book>
                <app-product-item [book]="book"></app-product-item>
              </ng-template>

            </p-carousel>

          </ng-container>
        </p-tabpanel>

      </p-tabpanels>

    </p-tabs>

  </div>
  <p-divider class="custom-divider"></p-divider>
   -->
  
  <div class="introduce-bookstore">
    <div class="intro-1">
      <h1>Về chúng tôi Pam Tech</h1>
      <h4>Sách là thế giới vô hạn mở ra tầm nhìn của con người</h4>
      <p class="pamtech-description">Chào mừng bạn đến với Pam Tech – nơi những cuốn sách hay gặp gỡ người yêu tri thức! Tại đây, bạn không chỉ tìm thấy sách, mà còn tìm thấy cảm hứng, sự sáng tạo và cả những món quà học tập dễ thương cho mọi lứa tuổi.
      Pam Tech là nhà sách hiện đại kết hợp giữa công nghệ và tri thức, mang đến trải nghiệm mua sắm sách tiện lợi, nhanh chóng và đáng tin cậy. Chúng tôi tự hào cung cấp hàng ngàn đầu sách đa dạng cùng các sản phẩm học tập, văn phòng phẩm và đồ chơi giáo dục chất lượng cao.
      </p>
        <a class="more"> Xem thêm</a>
      </div>
    <div class="intro-2">
      <img src="assets/images/aboutUs.jpg" alt="">
    </div>
  </div>

  <p-divider class="custom-divider"></p-divider>
  <!-- các tác giả -->
  <div class="author-title">
    <h1>Các tác giả nổi bật</h1>
  </div>

  <p-carousel 
    [value]="authors" 
    [numVisible]="6" 
    [numScroll]="1" 
    [circular]="true" 
    [responsiveOptions]="responsiveOptions"
    [showIndicators]="false"
    styleClass="custom-carousel"
  >
    <ng-template let-author pTemplate="item">
      <div class="author-card">
        <a [routerLink]="['/author', author._id]" class="author-item">
          <img 
            *ngIf="author.avatar" 
            [src]="'http://localhost:3000' + author.avatar" 
            alt="{{ author.name }}"
            class="author-avatar"
          />
        </a>
        <a [routerLink]="['/author', author._id]" class="author-name-link">
          <h4 class="author-name">{{ author.name }}</h4>
        </a>
      </div>
    </ng-template>
  </p-carousel>

  <p-divider class="custom-divider"></p-divider>

  <!-- benefit -->
  <div class="benefits-container" >
    <div class="benefit-item">
      <i class="pi pi-truck"></i>
      <div>
        <h4>MIỄN PHÍ VẬN CHUYỂN</h4>
        <p>Đơn hàng từ 500,000VND</p>
      </div>
    </div>
  
    <div class="benefit-item">
      <i class="pi pi-refresh"></i>
      <div>
        <h4>DỄ DÀNG TIỆN LỢI</h4>
        <p>Đặt sách theo yêu cầu</p>
      </div>
    </div>
  
    <div class="benefit-item">
      <i class="pi pi-gift"></i>
      <div>
        <h4>TÍCH ĐIỂM ĐỔI QUÀ</h4>
        <p>Nhận nhiều ưu đãi</p>
      </div>
    </div>
  
    <div class="benefit-item">
      <i class="pi pi-star"></i>
      <div>
        <h4>DỊCH VỤ 5 SAO</h4>
        <p>150+ ratings từ Facebook</p>
      </div>
    </div>
  </div>
  
</ng-container>

