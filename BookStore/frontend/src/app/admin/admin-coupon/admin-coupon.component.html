<div class="admin-coupons">
  <div class="header">
    <h2>Quản lý Coupon</h2>
  </div>

  <div class="body-bar">
    <button pButton label="Thêm Coupon" icon="pi pi-plus" (click)="openDialog()"></button>
  </div>
  <p-table [value]="coupons" [paginator]="true" [rows]="10">
    <ng-template pTemplate="header">
      <tr>
        <th>Mã</th>
        <th>Loại</th>
        <th>Giá trị</th>
        <th>Đơn tối thiểu</th>
        <th>Ngày hiệu lực</th>
        <th>Trạng thái</th>
        <th>Thao tác</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-c>
      <tr>
        <td>{{ c.code }}</td>
        <td>{{ c.type === 'percent' ? 'Giảm %' : 'Giảm tiền' }}</td>
        <td>{{ c.value }}{{ c.type === 'percent' ? '%' : '₫' }}</td>
        <td>{{ c.minOrder | number }}₫</td>
        <td>{{ c.startDate | date }} - {{ c.endDate | date }}</td>
        <td><p-tag [value]="c.status" [severity]="c.status==='active'?'success':'danger'"></p-tag></td>
        <td class="actions">
          <button pButton text icon="pi pi-pencil" (click)="editCoupon(c)"></button>
          <button pButton text icon="pi pi-trash" severity="danger" (click)="deleteCoupon(c._id!)"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-dialog [(visible)]="displayDialog" header="{{ isEdit ? 'Sửa Coupon' : 'Thêm Coupon' }}">
    <form (ngSubmit)="saveCoupon()">
      <div class="p-fluid">
        <div class="p-field">
          <label>Mã CODE</label>
          <input pInputText type="text" [(ngModel)]="selectedCoupon.code" name="code" required />
        </div>

        <div class="p-field">
          <label>Loại</label>
          <p-dropdown [options]="typeOptions" [(ngModel)]="selectedCoupon.type" name="type"></p-dropdown>
        </div>

        <div class="p-field">
          <label>Giá trị</label>
          <input type="number" pInputText [(ngModel)]="selectedCoupon.value" name="value" required />
        </div>

        <div class="p-field">
          <label>Đơn tối thiểu</label>
          <input type="number" pInputText [(ngModel)]="selectedCoupon.minOrder" name="minOrder" />
        </div>

        <div class="p-field">
          <label>Ngày bắt đầu</label>
          <p-calendar [(ngModel)]="selectedCoupon.startDate" name="startDate" dateFormat="yy-mm-dd"></p-calendar>
        </div>

        <div class="p-field">
          <label>Ngày kết thúc</label>
          <p-calendar [(ngModel)]="selectedCoupon.endDate" name="endDate" dateFormat="yy-mm-dd"></p-calendar>
        </div>
      </div>

      <div class="dialog-actions">
        <button pButton (click)="show = false" label="Hủy"></button>
        <button pButton type="submit" label="Lưu"></button>
      </div>
    </form>
  </p-dialog>
</div>
